<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Pi Payment Demo</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f4f4f4;
      }
      h1 {
        color: #8a2be2;
      }
      button {
        margin: 10px 0;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }
      .guide {
        background: #fffbe7;
        border-left: 5px solid orange;
        padding: 10px;
        margin-top: 30px;
      }
    </style>
  </head>
  <body>
    <h1>ğŸµ ChÃ o má»«ng Ä‘áº¿n vá»›i PiChordify Kingdom!</h1>
    <p>ğŸ‘‰ Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c khi thanh toÃ¡n:</p>
    <button onclick="login()">ÄÄƒng nháº­p Pi</button>

    <p>ğŸ’° Sau khi Ä‘Äƒng nháº­p, chá»n gÃ³i Ä‘á»ƒ thanh toÃ¡n:</p>
    <button onclick="pay('Premium 0.1 Pi', 0.1)">Thanh toÃ¡n 0.1 Pi</button>

    <div class="guide">
      <strong>ğŸ“˜ HÆ°á»›ng dáº«n:</strong><br/>
      1. Báº¥m nÃºt "ÄÄƒng nháº­p Pi"<br/>
      2. Sau khi hiá»‡n tÃªn ngÆ°á»i dÃ¹ng, báº¥m nÃºt "Thanh toÃ¡n 0.1 Pi"<br/>
      3. Thao tÃ¡c trong vÃ­ Pi (Pi Browser) Ä‘á»ƒ hoÃ n táº¥t<br/>
      4. Náº¿u bá»‹ há»§y/táº¯t sá»›m, há»‡ thá»‘ng sáº½ thÃ´ng bÃ¡o<br/>
      5. Náº¿u khÃ´ng pháº£n há»“i, thá»­ láº¡i sau vÃ i phÃºt
    </div>

    <script>
      Pi.init({ version: "2.0", sandbox: true });

      let username = "";
      function login() {
        const scopes = ['username', 'payments'];
        const onIncompletePaymentFound = (payment) => {
          console.log('Incomplete payment found:', payment);
        };

        Pi.authenticate(scopes, onIncompletePaymentFound)
          .then(function(auth) {
            username = auth.user.username;
            alert("Xin chÃ o, " + username);
          })
          .catch(function(error) {
            alert("ÄÄƒng nháº­p tháº¥t báº¡i: " + error);
          });
      }

      function pay(planName, amount) {
        Pi.createPayment({
          amount: amount,
          memo: planName,
          metadata: { type: "premium_package", plan: planName }
        }, {
          onReadyForServerApproval: function(paymentId) {
            console.log("Chá» duyá»‡t... " + paymentId);
          },
          onReadyForServerCompletion: function(paymentId, txid) {
            console.log("HoÃ n táº¥t giao dá»‹ch: " + txid);
            alert("Cáº£m Æ¡n báº¡n Ä‘Ã£ mua gÃ³i: " + planName);
          },
          onCancel: function(paymentId) {
            alert("Báº¡n Ä‘Ã£ huá»· thanh toÃ¡n.");
          },
          onError: function(error, payment) {
            alert("Lá»—i thanh toÃ¡n: " + error);
          }
        });
      }
    </script>
  </body>
</html>
