<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>[DEBUG] Tranmusickingdom Pi App</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    button { margin: 10px; padding: 12px 24px; font-size: 16px; }
    #log {
      margin-top: 20px; padding: 10px;
      border: 1px solid #ccc; border-radius: 8px;
      text-align: left; max-width: 700px;
      margin-left: auto; margin-right: auto;
      background: #f8f8f8; font-size: 14px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>[DEBUG] Tranmusickingdom Pi App</h1>
  <button onclick="login()">ğŸ” ÄÄƒng nháº­p báº±ng Pi</button>
  <button onclick="pay()">ğŸ’° Thanh toÃ¡n 0.01 Pi</button>

  <div id="log">[LOG báº¯t Ä‘áº§u...]\n</div>

  <script>
    function log(msg) {
      const div = document.getElementById("log");
      div.textContent += msg + "\n";
      console.log(msg);
    }

    // Step 1: Init SDK
    try {
      log("ğŸŸ¡ BÆ°á»›c 1: Äang khá»Ÿi táº¡o Pi SDK...");
      Pi.init({ version: "2.0", sandbox: true });
      log("âœ… SDK khá»Ÿi táº¡o xong (sandbox: true)");
    } catch (err) {
      log("âŒ Lá»—i khi init SDK: " + err);
    }

    // Step 2: Login
    function login() {
      log("â–¶ Báº¯t Ä‘áº§u Pi.authenticate()...");
      alert("Báº¯t Ä‘áº§u login...");

      try {
        const scopes = ['username', 'payments'];
        Pi.authenticate(scopes, (payment) => {
          log("âš  Incomplete payment found: " + JSON.stringify(payment));
        })
        .then(auth => {
          log("âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng: " + JSON.stringify(auth));
          alert("Xin chÃ o " + auth.user.username);
        })
        .catch(err => {
          log("âŒ ÄÄƒng nháº­p lá»—i: " + err);
          alert("Lá»—i Ä‘Äƒng nháº­p: " + err);
        });
      } catch (e) {
        log("âŒ Lá»—i JS trong login(): " + e);
      }
    }

    // Step 3: Payment
    function pay() {
      log("â–¶ Báº¯t Ä‘áº§u thanh toÃ¡n thá»­...");
      alert("Báº¯t Ä‘áº§u thanh toÃ¡n test...");

      try {
        const paymentData = {
          amount: 0.01,
          memo: "Sandbox test",
          metadata: { orderId: 314 }
        };

        Pi.createPayment(paymentData, {
          onReadyForServerApproval: (paymentId) => {
            log("ğŸŸ¡ onReadyForServerApproval: " + paymentId);
          },
          onReadyForServerCompletion: (paymentId, txid) => {
            log("âœ… onReadyForServerCompletion: " + paymentId + " | txid: " + txid);
          },
          onCancel: (paymentId) => {
            log("âš  Payment bá»‹ há»§y: " + paymentId);
          },
          onError: (error, paymentId) => {
            log("âŒ Payment lá»—i: " + error + " | paymentId: " + paymentId);
          }
        });
      } catch (e) {
        log("âŒ Lá»—i JS trong pay(): " + e);
      }
    }
  </script>
</body>
</html>
