<!DOCTYPE html>
<html>
<head>
  <title>Tran682025 Pi App</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>Welcome to Tran682025 Pi App</h1>

  <button onclick="login()">ğŸ” ÄÄƒng nháº­p vá»›i Pi</button>
  <br><br>
  <button onclick="pay()">ğŸ’° Thanh toÃ¡n 0.01 Pi</button>

  <script>
    Pi.init({ version: "2.0", sandbox: true });

    let username = "";

    function login() {
      const scopes = ['username', 'payments'];
      const onIncompletePaymentFound = (payment) => {
        console.log('â— Incomplete payment found:', payment);
      };

      Pi.authenticate(scopes, onIncompletePaymentFound)
        .then(function(auth) {
          username = auth.user.username;
          console.log('âœ… Authentication success', auth);
          alert("Xin chÃ o, " + username);
        })
        .catch(function(error) {
          console.error('âŒ Authentication failed:', error);
          alert("ÄÄƒng nháº­p tháº¥t báº¡i: " + error);
        });
    }

    function pay() {
      if (!username) {
        alert("Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c khi thanh toÃ¡n.");
        return;
      }

      Pi.createPayment({
        amount: 0.01,
        memo: "Thanh toÃ¡n test",
        metadata: { type: "sandbox_demo" }
      }, {
        onReadyForServerApproval: function(paymentId) {
          console.log("ğŸŸ¡ Ready for server approval", paymentId);
        },
        onReadyForServerCompletion: function(paymentId, txid) {
          console.log("ğŸŸ¢ Ready for server completion", paymentId, txid);
        },
        onCancel: function(paymentId) {
          console.warn("ğŸ”´ Payment cancelled", paymentId);
        },
        onError: function(error, paymentId) {
          console.error("âŒ Payment error", error);
        }
      }).then(function(payment) {
        console.log("âœ… Payment created", payment);
        alert("ÄÃ£ gá»­i yÃªu cáº§u thanh toÃ¡n. Vui lÃ²ng chá»...");
      }).catch(function(err) {
        console.error("âŒ Failed to create payment", err);
      });
    }
  </script>
</body>
</html>
