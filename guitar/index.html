<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üé∏ Pi Guitar Premium ‚Äì Demo</title>
  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      background: #f7f7fb;
      margin: 0;
      padding: 20px;
      color: #111;
    }
    h1, h2, h3 { text-align: center; }
    .container { max-width: 1000px; margin: auto; }
    button {
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      background: #7c3aed;
      color: #fff;
      font-weight: bold;
      margin: 5px;
    }
    button.outline {
      background: #fff;
      border: 2px solid #7c3aed;
      color: #7c3aed;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .toolbar {
      text-align: center;
      margin: 15px 0;
    }
    input[type="range"] {
      width: 180px;
    }
    .chord-strip {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 10px 0;
    }
    .chip {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 5px 10px;
      background: #fff;
      cursor: pointer;
    }
    .chip.active { background: #e9d5ff; border-color: #7c3aed; }
    .instrument-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .timeline {
      background: #ddd;
      height: 10px;
      border-radius: 5px;
      margin: 10px 0;
      position: relative;
    }
    .progress {
      background: #7c3aed;
      height: 10px;
      width: 0%;
      border-radius: 5px;
      transition: width 0.3s;
    }
    .song-list {
      text-align: center;
      margin: 15px 0;
    }
    footer {
      margin-top: 20px;
      text-align: center;
      color: #777;
      font-size: 14px;
    }
  </style>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <div class="container">
    <h1>üé∏ Pi Guitar Premium</h1>

    <!-- Pi Login & Pay -->
    <div style="text-align:center;">
      <button onclick="loginPi()">ƒêƒÉng nh·∫≠p v·ªõi Pi</button>
      <button onclick="payPi()">Mua Premium 1 Pi/th√°ng</button>
      <div id="status">Ch∆∞a ƒëƒÉng nh·∫≠p.</div>
    </div>

    <!-- Ch·ªçn b√†i h√°t -->
    <div class="song-list">
      <h3>Ch·ªçn b√†i h√°t demo</h3>
      <button onclick="loadSong('cam-on-nguoi-tinh')">C·∫£m ∆†n Ng∆∞·ªùi T√¨nh</button>
      <button onclick="loadSong('hallelujah')">Hallelujah</button>
      <button onclick="loadSong('perfect')">Perfect (Ed Sheeran)</button>
    </div>

    <!-- Player -->
    <div class="toolbar">
      <button id="playBtn">‚ñ∂Ô∏è Play</button>
      <button id="restartBtn" class="outline">‚ü≤ Restart</button>
      <div style="margin-top:10px;">T·ªëc ƒë·ªô: <span id="speedValue">100%</span></div>
      <input id="speedRange" type="range" min="50" max="150" step="10" value="100" />
    </div>

    <div class="timeline">
      <div id="progress" class="progress"></div>
    </div>

    <!-- Hi·ªÉn th·ªã h·ª£p √¢m -->
    <h3 id="currentChord">H·ª£p √¢m hi·ªán t·∫°i: Cm</h3>
    <div id="strip" class="chord-strip"></div>
    <div id="boards" style="text-align:center;"></div>

    <!-- L·ªùi b√†i h√°t -->
    <h3>L·ªùi b√†i h√°t</h3>
    <div id="lyrics" style="text-align:center; font-size: 14px; white-space: pre-line; margin:10px;"></div>

    <!-- N√∫t ch·ªçn nh·∫°c c·ª• -->
    <div class="instrument-buttons">
      <button onclick="setInstrument('guitar')">Guitar</button>
      <button onclick="setInstrument('ukulele')">Ukulele</button>
      <button onclick="setInstrument('piano')">Piano</button>
      <button onclick="setInstrument('mandolin')">Mandolin</button>
    </div>

    <footer>
      ¬© Tranmarket & R√πa üê¢ | Pi SDK v2.0 | Sandbox Demo
    </footer>
  </div>

<script>
  // ===================== PI SDK ===================== //
  Pi.init({ version: "2.0", sandbox: true });

  function loginPi() {
    const scopes = ['username', 'payments'];
    Pi.authenticate(scopes, p => console.log('Incomplete payment:', p))
      .then(auth => document.getElementById('status').innerText = "Xin ch√†o, " + auth.user.username)
      .catch(err => alert("Login th·∫•t b·∫°i: " + err));
  }

  function payPi() {
    Pi.createPayment({
      amount: 1,
      memo: "Premium Guitar Chords 1 th√°ng",
      metadata: { productId: "premium_1_month" }
    }, {
      onReadyForServerCompletion: () => {
        document.getElementById('status').innerText = "Thanh to√°n th√†nh c√¥ng! Premium ƒë√£ m·ªü kh√≥a.";
        premiumUnlocked = true;
      },
      onCancel: () => alert("H·ªßy thanh to√°n"),
      onError: e => alert("L·ªói: " + e)
    });
  }

  // ===================== DATA ===================== //
  const songs = {
    "cam-on-nguoi-tinh": {
      chords: ["Cm", "A‚ô≠", "Fm", "G", "G7", "Cm"],
      lyrics: "C·∫£m ∆°n ng∆∞·ªùi t√¨nh ...\nƒê√£ cho ta gi·∫•c m∆° ng·ªçt ng√†o..."
    },
    "hallelujah": {
      chords: ["C", "Am", "F", "G", "C", "G"],
      lyrics: "Hallelujah, Hallelujah ..."
    },
    "perfect": {
      chords: ["G", "Em", "C", "D", "G", "C"],
      lyrics: "I found a love ... darling you look perfect tonight ..."
    }
  };

  let currentSong = "cam-on-nguoi-tinh";
  let chords = songs[currentSong].chords;
  let lyrics = songs[currentSong].lyrics;
  let currentChordIndex = 0;
  let speed = 100;
  let isPlaying = false;
  let premiumUnlocked = false;
  let instrument = 'guitar';
  let timer = null;

  const elPlay = document.getElementById('playBtn');
  const elRestart = document.getElementById('restartBtn');
  const elSpeed = document.getElementById('speedRange');
  const elSpeedValue = document.getElementById('speedValue');
  const elStrip = document.getElementById('strip');
  const elBoards = document.getElementById('boards');
  const elCurrentChord = document.getElementById('currentChord');
  const elProgress = document.getElementById('progress');
  const elLyrics = document.getElementById('lyrics');

  // ===================== PLAYER ===================== //
  function loadSong(name) {
    currentSong = name;
    chords = songs[name].chords;
    lyrics = songs[name].lyrics;
    currentChordIndex = 0;
    renderChords();
    renderLyrics();
    jump(0);
    resetProgress();
  }

  function jump(i) {
    currentChordIndex = i;
    elCurrentChord.innerText = "H·ª£p √¢m hi·ªán t·∫°i: " + chords[i];
    renderChords();
    renderBoard(chords[i]);
  }

  function play() {
    isPlaying = true;
    elPlay.innerText = "‚è∏ Pause";
    timer = setInterval(() => {
      currentChordIndex = (currentChordIndex + 1) % chords.length;
      jump(currentChordIndex);
      updateProgress();
    }, 2000 * (100 / speed));
  }

  function pause() {
    isPlaying = false;
    elPlay.innerText = "‚ñ∂Ô∏è Play";
    clearInterval(timer);
  }

  function updateProgress() {
    const progressPercent = ((currentChordIndex + 1) / chords.length) * 100;
    elProgress.style.width = progressPercent + "%";
  }

  function resetProgress() {
    elProgress.style.width = "0%";
  }

  elPlay.onclick = () => { isPlaying ? pause() : play(); };
  elRestart.onclick = () => { pause(); jump(0); resetProgress(); };
  elSpeed.oninput = e => { speed = e.target.value; elSpeedValue.innerText = speed + "%"; if (isPlaying) { pause(); play(); } };

  // ===================== RENDER ===================== //
  function renderChords() {
    elStrip.innerHTML = '';
    chords.forEach((c, i) => {
      if (!premiumUnlocked && i > 2) return;
      const div = document.createElement('div');
      div.className = 'chip' + (i === currentChordIndex ? ' active' : '');
      div.textContent = c;
      div.onclick = () => jump(i);
      elStrip.appendChild(div);
    });
  }

  function renderLyrics() {
    elLyrics.innerText = premiumUnlocked ? lyrics : lyrics.split('\n').slice(0, 2).join('\n') + "\n...\n(Mua Premium ƒë·ªÉ xem ƒë·∫ßy ƒë·ªß)";
  }

  function renderBoard(chord) {
    elBoards.innerHTML = `<div style="padding:10px;"><b>${chord}</b> (s∆° ƒë·ªì demo ${instrument})</div>`;
  }

  function setInstrument(instr) {
    instrument = instr;
    renderBoard(chords[currentChordIndex]);
  }

  // ===================== INIT ===================== //
  loadSong(currentSong);
</script>
</body>
</html>
